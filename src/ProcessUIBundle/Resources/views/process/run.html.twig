{% extends '@DarkilliantProcessUI/layout.html.twig' %}

{% block javascript %}
{{ parent() }}
    <script type="text/javascript">
        {% if runnable %}
        var source = new EventSource('{{ path('darkilliant_processui_run', {'processName': processName, 'context': context}) }}');
        source.onmessage = function(e) {
            if (!e) {
                source.close();
            }

            var data = JSON.parse(e.data);
            if ('log' == data.type) {
                console.log(data.message);
                $('#log').append('<div class="log-'+data.level +'">' + data.message + '<br> <span class="blue">(' + JSON.stringify(data.context) + ')</span> </div> <br>');
            } else {
                $('#progress').text(data.progress);
                $('#count').text(data.count);
                var valeur = (data.progress / data.count) * 100;
                $('.progress-bar').css('width', valeur+'%').attr('aria-valuenow', valeur);
            }
        };
        source.onerror = function(e) {
            source.close();
        };

        setInterval(function ()
        {
            $("#log").scrollTop($("#log")[0].scrollHeight);
        }, 500); // ms = 3 sec
        {% endif %}
    </script>
{% endblock %}

{% block body %}
    <div class="container">
        <div class="row">
            <div class="col-xs-12">
                <div class="panel panel-primary">
                    <div class="panel-heading">Process {{ processName }}</div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-xs-4">
                                <div><span id="progress">x</span> sur <span id="count">x</span> elements</div>
                                <div class="progress">
                                    <div class="progress-bar bg-success" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <div>
                                    Configurable,
                                    <form action="#" method="post">
                                        {% for item in configurable %}
                                            <div class="form-group">
                                                <label>{{ item }}</label>
                                                <input name="{{ item }}" type="text" class="form-control" value="{{ app.request.request.get(item, '') }}"/>
                                            </div>
                                        {% endfor %}
                                        <div>
                                            <button class="btn btn-success">Lancer</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <div class="col-xs-8">
                                <div class="col-xs-12">
                                    <div id="log" style="height: 500px; background: black; color: white; overflow: auto;">

                                    </div>
                                </div>
                                <div class="col-xs-12">
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-primary">Info</button>
                                        <button type="button" class="btn btn-danger">Error</button>
                                        <button type="button" class="btn btn-success">Debug</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
